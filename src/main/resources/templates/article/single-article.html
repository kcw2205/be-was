<div class="post">
    <div class="post__account">
        <img class="post__account__img" src="/{{ authorProfileImagePath }}"/>
        <p class="post__account__nickname">{{ authorName }}</p>
    </div>
    <img class="post__img" src="/{{ articleImagePath }}"/>
    <div class="post__menu">
        <ul class="post__menu__personal">
            <li>
                <button class="post__menu__btn" id="like-btn">
                    <img src="/img/like.svg"/>
                </button>
            </li>
            <li>
                <button class="post__menu__btn">
                    <img src="/img/comment.svg"/>
                </button>
            </li>
        </ul>
        <button class="post__menu__btn">
            <img src="/img/bookMark.svg"/>
        </button>
    </div>

    <div class="post__likes" style="margin-bottom: 8px;">
        <p style="font-weight: 700; font-size: 14px;">
            좋아요 <span id="like-count">{{ likeCount }}</span>개
        </p>
    </div>

    <p class="post__article">
        {{ content }}
    </p>
</div>

{{ commentComponent }}

<nav class="nav">
    <ul class="nav__menu">
        <li class="nav__menu__item">
            <a class="nav__menu__item__btn nav__menu__item__btn_{{ prevArticleStatus }}" href="/?articleId={{ prevArticleId }}">
                <img
                        class="nav__menu__item__img"
                        src="/img/ci_chevron-left.svg"
                />
                이전 글
            </a>
        </li>
        <li class="nav__menu__item">
            <a class="btn btn_ghost btn_size_m" href="/comment?articleId={{ articleId }}">댓글 작성</a>
        </li>
        <li class="nav__menu__item">
            <a class="nav__menu__item__btn nav__menu__item__btn_{{ nextArticleStatus }}" href="/?articleId={{ nextArticleId }}">
                다음 글
                <img
                        class="nav__menu__item__img"
                        src="/img/ci_chevron-right.svg"
                />
            </a>
        </li>
    </ul>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const likeBtn = document.querySelector('#like-btn');

        const articleId = {{ articleId }};

        if (!likeBtn || !articleId) return;

        likeBtn.addEventListener('click', async () => {
            if (confirm("좋아요를 누르시겠습니까?")) {
                try {
                    const params = new URLSearchParams();
                    params.append('articleId', articleId);

                    const response = await fetch('/article/like', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: params
                    });

                    if (response.ok) {
                        // 성공 시 해당 articleId 페이지 다시 로딩
                        window.location.href = `/?articleId=${articleId}`;
                    } else {
                        const errorMsg = await response.text();
                        alert("좋아요 반영 실패: " + errorMsg);
                    }
                } catch (error) {
                    console.error("Error:", error);
                    alert("네트워크 오류가 발생했습니다.");
                }
            }
        });
    });
</script>